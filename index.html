<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Re-Gen AI Chat & Image Generator</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; padding: 1rem; display: flex; justify-content: center; }
    .container { background: white; width: 100%; max-width: 800px; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .tabs { display: flex; }
    .tab { flex: 1; text-align: center; padding: 1rem; cursor: pointer; background: #eee; }
    .tab.active { background: #007bff; color: white; }
    .panel { display: none; padding: 1rem; }
    .panel.active { display: block; }
    .messages { max-height: 400px; overflow-y: auto; background: #fafafa; padding: 1rem; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 1rem; }
    .message { margin-bottom: 0.75rem; }
    .message.user { text-align: right; }
    .message.bot { text-align: left; }
    .bubble { display: inline-block; padding: 0.5rem 1rem; border-radius: 16px; max-width: 80%; }
    .message.user .bubble { background: #007bff; color: white; }
    .message.bot .bubble { background: #eee; color: #333; }
    .timestamp { font-size: 0.75rem; color: #999; }
    .input-area { display: flex; gap: 0.5rem; }
    .input-area input[type="text"] { flex: 1; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px; }
    .input-area button { padding: 0.5rem 1rem; border: none; border-radius: 4px; background: #007bff; color: white; cursor: pointer; }
    .input-area button:disabled { background: #aaa; }
    /* Image panel styles */
    .result { text-align: center; }
    .result img { max-width: 100%; border-radius: 8px; margin-top: 1rem; }
    .download-btn { display: inline-block; margin-top: 0.5rem; text-decoration: none; background: #28a745; color: white; padding: 0.5rem 1rem; border-radius: 4px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="tabs">
      <div class="tab active" id="tab-chat">Chat</div>
      <div class="tab" id="tab-image">Image</div>
    </div>
    <!-- Chat Panel -->
    <div class="panel active" id="panel-chat">
      <div class="messages" id="chatMessages"></div>
      <div class="input-area">
        <input type="text" id="chatInput" placeholder="Type a message..." />
        <button id="chatSendBtn">Send Chat</button>
      </div>
    </div>
    <!-- Image Panel -->
    <div class="panel" id="panel-image">
      <input type="text" id="imgPrompt" placeholder="Enter image prompt..." style="width:100%; margin-bottom:0.5rem; padding:0.5rem; border:1px solid #ccc; border-radius:4px;" />
      <button id="imgGenerateBtn" style="width:100%; margin-bottom:1rem;">Generate Image</button>
      <div class="result" id="imgResult"></div>
    </div>
  </div>

  <script>
    // Tab switching
    const tabChat = document.getElementById('tab-chat');
    const tabImage = document.getElementById('tab-image');
    const panelChat = document.getElementById('panel-chat');
    const panelImage = document.getElementById('panel-image');
    tabChat.addEventListener('click', () => {
      tabChat.classList.add('active'); tabImage.classList.remove('active');
      panelChat.classList.add('active'); panelImage.classList.remove('active');
    });
    tabImage.addEventListener('click', () => {
      tabImage.classList.add('active'); tabChat.classList.remove('active');
      panelImage.classList.add('active'); panelChat.classList.remove('active');
    });

    // Chat functionality
    const chatMessagesEl = document.getElementById('chatMessages');
    const chatInputEl = document.getElementById('chatInput');
    const chatSendBtn = document.getElementById('chatSendBtn');
    const CHAT_API_URL = 'https://cheapest-gpt-4-turbo-gpt-4-vision-chatgpt-openai-ai-api.p.rapidapi.com/v1/chat/completions';
    const HEADERS_CHAT = {
      'Content-Type': 'application/json',
      'x-rapidapi-host': 'cheapest-gpt-4-turbo-gpt-4-vision-chatgpt-openai-ai-api.p.rapidapi.com',
      'x-rapidapi-key': '82ae10db11mshb41ccacdd991130p108a22jsnf3ae22b94bbd'
    };
    function appendChat(role, text) {
      const msg = document.createElement('div');
      msg.className = 'message ' + (role === 'user' ? 'user' : 'bot');
      const bubble = document.createElement('div'); bubble.className = 'bubble'; bubble.textContent = text;
      msg.appendChild(bubble);
      const timeEl = document.createElement('div'); timeEl.className = 'timestamp'; timeEl.textContent = new Date().toLocaleTimeString([], { hour:'2-digit', minute:'2-digit' });
      msg.appendChild(timeEl);
      chatMessagesEl.appendChild(msg);
      chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight;
    }
    chatSendBtn.addEventListener('click', async () => {
      const text = chatInputEl.value.trim(); if (!text) return;
      appendChat('user', text); chatInputEl.value = '';
      chatSendBtn.disabled = true;
      try {
        const payload = { messages: [{ role: 'user', content: text }], model: 'gpt-4o', max_tokens: 150 };
        const res = await fetch(CHAT_API_URL, { method: 'POST', headers: HEADERS_CHAT, body: JSON.stringify(payload) });
        if (!res.ok) throw new Error(res.status);
        const data = await res.json();
        const reply = data.choices?.[0]?.message?.content || 'No response';
        appendChat('bot', reply);
      } catch (e) {
        appendChat('bot', 'Error: ' + e.message);
      }
      chatSendBtn.disabled = false;
    });

    chatInputEl.addEventListener('keydown', e => { if (e.key === 'Enter') { e.preventDefault(); chatSendBtn.click(); }});

    // Image functionality
    const imgPromptEl = document.getElementById('imgPrompt');
    const imgGenerateBtn = document.getElementById('imgGenerateBtn');
    const imgResultEl = document.getElementById('imgResult');
    const FLUX_API_URL = 'https://ai-text-to-image-generator-flux-free-api.p.rapidapi.com/aaaaaaaaaaaaaaaaaiimagegenerator/fluximagegenerate/generateimage.php';
    const HEADERS_FLUX = {
      'Content-Type': 'application/x-www-form-urlencoded',
      'x-rapidapi-host': 'ai-text-to-image-generator-flux-free-api.p.rapidapi.com',
      'x-rapidapi-key': '82ae10db11mshb41ccacdd991130p108a22jsnf3ae22b94bbd'
    };
    imgGenerateBtn.addEventListener('click', async () => {
      const prompt = imgPromptEl.value.trim(); if (!prompt) return;
      imgResultEl.innerHTML = '';
      imgGenerateBtn.disabled = true;
      try {
        const params = new URLSearchParams({ prompt, width:'1024', height:'1024', seed:'918440', model:'flux' });
        const res = await fetch(FLUX_API_URL, { method: 'POST', headers: HEADERS_FLUX, body: params.toString() });
        if (!res.ok) throw new Error(res.status);
        const blob = await res.blob();
        const url = URL.createObjectURL(blob);
        imgResultEl.innerHTML = `<img src="${url}" alt="Generated" /><br/><a href="${url}" download="generated.png" class="download-btn">Download Image</a>`;
      } catch (e) {
        imgResultEl.textContent = 'Error: ' + e.message;
      }
      imgGenerateBtn.disabled = false;
    });
  </script>
</body>
</html>
