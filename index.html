<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Re-Gen AI Image Generator</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
    .container { background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 500px; width: 100%; }
    h1 { margin-top: 0; text-align: center; }
    form { display: flex; flex-direction: column; gap: 1rem; }
    label { font-weight: bold; }
    input[type="text"], select, input[type="number"] { padding: 0.5rem; font-size: 1rem; border: 1px solid #ccc; border-radius: 4px; }
    button { padding: 0.75rem; font-size: 1rem; border: none; border-radius: 4px; background: #007bff; color: white; cursor: pointer; }
    button:disabled { background: #aaa; cursor: not-allowed; }
    .result { margin-top: 1.5rem; text-align: center; }
    .result img { max-width: 100%; border-radius: 4px; }
    .download-btn { margin-top: 0.5rem; display: inline-block; text-decoration: none; background: #28a745; color: white; padding: 0.5rem 1rem; border-radius: 4px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Re-Gen AI Image Generator</h1>
    <form id="image-form">
      <div>
        <label for="apiSelect">Choose Style/API:</label>
        <select id="apiSelect" required>
          <option value="flux">Flux Image AI</option>
          <option value="cartoon">Cartoon Yourself</option>
        </select>
      </div>
      <div>
        <label for="prompt">Prompt:</label>
        <input type="text" id="prompt" placeholder="Enter your prompt" required />
      </div>

      <div id="fluxParams">
        <label for="width">Width:</label>
        <input type="number" id="width" value="1024" required />
        <label for="height">Height:</label>
        <input type="number" id="height" value="1024" required />
        <label for="seed">Seed:</label>
        <input type="number" id="seed" value="918440" required />
        <label for="model">Model:</label>
        <input type="text" id="model" value="flux" required />
      </div>

      <div id="imageUrlContainer" style="display:none;">
        <label for="imageUrl">Source Image URL:</label>
        <input type="text" id="imageUrl" placeholder="https://upload.wikimedia.org/wikipedia/commons/a/a6/Anonymous_emblem.svg" />
      </div>

      <button type="submit" id="generateBtn">Generate Image</button>
    </form>
    <div class="result" id="result"></div>
  </div>

  <script>
    const apiSelect = document.getElementById('apiSelect');
    const imageUrlContainer = document.getElementById('imageUrlContainer');
    const fluxParams = document.getElementById('fluxParams');
    const resultEl = document.getElementById('result');

    function toggleParams() {
      const style = apiSelect.value;
      imageUrlContainer.style.display = style === 'cartoon' ? 'block' : 'none';
      fluxParams.style.display = style === 'flux' ? 'block' : 'none';
    }

    apiSelect.addEventListener('change', toggleParams);
    toggleParams();

    function extractImageUrlFromJson(data) {
      const candidates = [
        data.imageUrl,
        data.resultUrl,
        Array.isArray(data.output) && data.output[0],
        data.url,
        Array.isArray(data.urls) && data.urls[0],
        Array.isArray(data.data) && data.data[0],
        data.image,
        data.img,
        data.base64 && `data:image/png;base64,${data.base64}`,
      ];
      return candidates.find(x => typeof x === 'string' && x.length > 0);
    }

    document.getElementById('image-form').addEventListener('submit', async e => {
      e.preventDefault();
      resultEl.innerHTML = 'Generating...';

      const style = apiSelect.value;
      const prompt = document.getElementById('prompt').value.trim();

      let url, options;
      if (style === 'cartoon') {
        const imageUrl = document.getElementById('imageUrl').value.trim();
        if (!imageUrl) {
          alert('Please provide a source image URL for Cartoon Yourself.');
          return;
        }
        url = 'https://cartoon-yourself.p.rapidapi.com/facebody/api/portrait-animation/portrait-animation';
        const body = new URLSearchParams();
        body.set('image_url', imageUrl); // Ensure only one entry
        options = {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'x-rapidapi-host': 'cartoon-yourself.p.rapidapi.com',
            'x-rapidapi-key': '82ae10db11mshb41ccacdd991130p108a22jsnf3ae22b94bbd'
          },
          body: body.toString()
        };
      } else {
        const width = document.getElementById('width').value;
        const height = document.getElementById('height').value;
        const seed = document.getElementById('seed').value;
        const model = document.getElementById('model').value;
        url = 'https://ai-text-to-image-generator-flux-free-api.p.rapidapi.com/aaaaaaaaaaaaaaaaaiimagegenerator/fluximagegenerate/generateimage.php';
        const body = new URLSearchParams();
        body.append('prompt', prompt);
        body.append('width', width);
        body.append('height', height);
        body.append('seed', seed);
        body.append('model', model);
        options = {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'x-rapidapi-host': 'ai-text-to-image-generator-flux-free-api.p.rapidapi.com',
            'x-rapidapi-key': '82ae10db11mshb41ccacdd991130p108a22jsnf3ae22b94bbd'
          },
          body: body.toString()
        };
      }

      try {
        const response = await fetch(url, options);
        if (!response.ok) throw new Error(`HTTP ${response.status}`);

        const contentType = response.headers.get('Content-Type') || '';
        let imageSrc;

        if (contentType.includes('application/json')) {
          const data = await response.json();
          imageSrc = extractImageUrlFromJson(data);
          if (!imageSrc) {
            console.warn('No URL in JSON, falling back to blob');
            const blob = await response.blob();
            imageSrc = URL.createObjectURL(blob);
          }
        } else {
          const blob = await response.blob();
          imageSrc = URL.createObjectURL(blob);
        }

        resultEl.innerHTML = `
          <img src="${imageSrc}" alt="Generated Image" />
          <br/>
          <a href="${imageSrc}" download="generated.png" class="download-btn">Download Image</a>
        `;
      } catch (err) {
        console.error(err);
        resultEl.innerHTML = 'Error: ' + err.message;
      }
    });
  </script>
</body>
</html>
