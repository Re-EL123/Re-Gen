<!DOCTYPE html>
<html lang="en" ng-app="regenApp">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Re-Gen AI Chat & Image Generator</title>
  <!-- AngularJS + ngAnimate -->
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular-animate.min.js"></script>

  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --accent:#6ee7b7; --accent-2:#60a5fa; --muted:#94a3b8;
    }
    *{box-sizing:border-box}
    body{font-family:Inter,Segoe UI,Roboto,Arial; margin:0; min-height:100vh; background:linear-gradient(180deg,var(--bg),#071127); display:flex; align-items:center; justify-content:center; padding:24px;}

    .container{width:100%; max-width:980px; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:14px; overflow:hidden; box-shadow:0 10px 40px rgba(2,6,23,0.7); display:grid; grid-template-columns:360px 1fr; gap:0;}

    /* Left column */
    .sidebar{padding:20px; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-right:1px solid rgba(255,255,255,0.03);}
    .brand{display:flex; align-items:center; gap:12px; margin-bottom:12px}
    .logo{width:48px; height:48px; border-radius:10px; background:linear-gradient(135deg,var(--accent),var(--accent-2)); box-shadow:0 6px 18px rgba(99,102,241,0.12); display:flex; align-items:center; justify-content:center; color:#041023; font-weight:700}
    h1{font-size:18px; margin:0; color:#e6eef9}
    p.lead{margin:6px 0 12px; color:var(--muted); font-size:13px}

    .tabs{display:flex; gap:8px; margin-bottom:14px}
    .tab-btn{flex:1; padding:10px 12px; border-radius:10px; cursor:pointer; text-align:center; background:transparent; border:1px solid rgba(255,255,255,0.03); color:var(--muted); transition:all .25s ease}
    .tab-btn.active{background:linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); color:#e6eef9; box-shadow:0 6px 18px rgba(59,130,246,0.06); transform:translateY(-2px)}

    .small{font-size:12px}
    .controls{margin-top:8px; display:flex; gap:8px; flex-direction:column}
    .input, .select, button{padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:#e6eef9}
    .input::placeholder{color:rgba(230,238,249,0.35)}
    .muted{color:var(--muted); font-size:12px}

    /* Right panel */
    .main{padding:18px}
    .panel-head{display:flex; align-items:center; justify-content:space-between; gap:12px}
    .panel-title{font-size:16px; color:#e6eef9}
    .panel-sub{color:var(--muted); font-size:13px}

    .messages{height:56vh; max-height:720px; overflow:auto; padding:16px; margin-top:14px; border-radius:12px; background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00)); border:1px solid rgba(255,255,255,0.03)}

    .msg{display:flex; margin-bottom:12px; align-items:flex-end; opacity:0; transform:translateY(8px); transition:all .32s cubic-bezier(.2,.9,.2,1)}
    .msg.ng-enter{opacity:0; transform:translateY(12px)}
    .msg.ng-enter-active{opacity:1; transform:translateY(0)}

    .msg.user{justify-content:flex-end}
    .bubble{max-width:70%; padding:10px 14px; border-radius:14px; font-size:14px; line-height:1.3}
    .bubble.user{background:linear-gradient(90deg,var(--accent-2),#3b82f6); color:white; border-bottom-right-radius:6px}
    .bubble.bot{background:rgba(255,255,255,0.03); color:var(--muted); border-bottom-left-radius:6px}
    .time{font-size:11px; color:rgba(230,238,249,0.4); margin-top:6px}

    .input-area{display:flex; gap:10px; margin-top:12px}
    .text-in{flex:1; padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,0.03); background:#071226; color:#e6eef9}
    .btn{padding:12px 16px; border-radius:12px; border:none; cursor:pointer; background:linear-gradient(90deg,var(--accent),var(--accent-2)); color:#041023; font-weight:600}
    .btn[disabled]{opacity:.5; cursor:not-allowed}

    /* image result */
    .image-panel{margin-top:12px}
    .result img{max-width:100%; border-radius:12px; display:block}
    .download-btn{display:inline-block; margin-top:8px; padding:8px 12px; border-radius:10px; background:#10b981; color:white; text-decoration:none}

    /* small screens */
    @media(max-width:900px){.container{grid-template-columns:1fr;}.sidebar{order:2}.main{order:1}}

    /* fancy micro animation */
    .pulse{animation:pulse 2s infinite}
    @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(99,102,241,0.12)}70%{box-shadow:0 0 0 18px rgba(99,102,241,0)}100%{box-shadow:0 0 0 0 rgba(99,102,241,0)}}

  </style>
</head>
<body ng-controller="MainCtrl as vm">
  <div class="container">
    <div class="sidebar">
      <div class="brand">
        <div class="logo">RG</div>
        <div>
          <h1>Re-Gen</h1>
          <p class="lead">AI Chat & Image — Grok-2 + Flux</p>
        </div>
      </div>

      <div class="tabs">
        <div class="tab-btn" ng-class="{active: vm.mode==='chat'}" ng-click="vm.switch('chat')">Chat</div>
        <div class="tab-btn" ng-class="{active: vm.mode==='image'}" ng-click="vm.switch('image')">Image</div>
      </div>

      <div class="controls">
        <input id="username" name="username" class="input" ng-model="vm.username" placeholder="Your name (optional)" autocomplete="name" />
        <select id="temperature" name="temperature" class="select" ng-model="vm.temperature">
          <option value="0.2">Creative: 0.2</option>
          <option value="0.5">Balanced: 0.5</option>
          <option value="1" selected>Exploratory: 1</option>
        </select>
        <div class="muted small">API Key and host are baked into this demo — replace with your own for production.</div>
        <button class="btn pulse" ng-click="vm.clearAll()">Clear Conversation</button>
      </div>
    </div>

    <div class="main">
      <div class="panel-head">
        <div>
          <div class="panel-title">{{ vm.mode === 'chat' ? 'AI Chat' : 'Image Generator' }}</div>
          <div class="panel-sub">{{ vm.mode === 'chat' ? 'Grok-2 by xAI (RapidAPI) — $http' : 'Flux image generator (demo)' }}</div>
        </div>
        <div>
          <button class="btn" ng-click="vm.quickUplift()">Quick Uplifting Quote</button>
        </div>
      </div>

      <!-- CHAT PANEL -->
      <div ng-show="vm.mode==='chat'">
        <div class="messages" id="chatMessages">
          <div ng-repeat="m in vm.messages track by $index" class="msg" ng-class="{'user': m.role==='user'}" ng-animate="'animate'">
            <div class="bubble" ng-class="{'user': m.role==='user','bot': m.role==='bot'}">{{ m.content }}</div>
            <div class="time">{{ m.ts | date:'shortTime' }}</div>
          </div>
        </div>

        <div class="input-area">
          <input id="chatText" name="chatText" class="text-in" ng-model="vm.chatText" placeholder="Type a message and press Enter or Send" ng-keydown="$event.keyCode===13 && vm.sendChat()" autocomplete="off" />
          <button class="btn" ng-disabled="!vm.chatText || vm.loading" ng-click="vm.sendChat()">{{ vm.loading ? 'Thinking...' : 'Send' }}</button>
        </div>
      </div>

      <!-- IMAGE PANEL -->
      <div ng-show="vm.mode==='image'">
        <div class="image-panel">
          <input id="imgPrompt" name="imgPrompt" class="text-in" ng-model="vm.imgPrompt" placeholder="Enter image prompt..." autocomplete="off" />
          <div style="display:flex; gap:8px; margin-top:8px">
            <button class="btn" ng-click="vm.generateImage()" ng-disabled="!vm.imgPrompt || vm.imgLoading">{{ vm.imgLoading ? 'Generating...' : 'Generate Image' }}</button>
            <button class="btn" ng-click="vm.clearImage()">Clear</button>
          </div>

          <div class="result" style="margin-top:12px" ng-if="vm.imgUrl">
            <img ng-src="{{vm.imgUrl}}" alt="generated" />
            <a class="download-btn" ng-href="{{vm.imgUrl}}" download="generated.png">Download Image</a>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- AngularJS App -->
  <script>
    angular.module('regenApp', ['ngAnimate'])
    .controller('MainCtrl', function($http, $timeout) {
      var vm = this;
      vm.mode = 'chat';
      vm.username = '';
      vm.temperature = 1;
      vm.messages = [];
      vm.chatText = '';
      vm.loading = false;

      vm.imgPrompt = '';
      vm.imgUrl = '';
      vm.imgLoading = false;

      vm.switch = function(mode){ vm.mode = mode; };
      vm.clearAll = function(){ vm.messages = []; vm.chatText=''; };
      vm.clearImage = function(){ vm.imgPrompt=''; vm.imgUrl=''; };

      // Robust sendChat function
      vm.sendChat = function(){
        if(!vm.chatText) return;
        var userMsg = {role:'user', content: vm.chatText, ts:new Date()};
        vm.messages.push(userMsg);
        var payload = vm.chatText;
        vm.chatText='';
        vm.loading=true;

        $http({
          method:'POST',
          url:'https://grok-2-by-xai.p.rapidapi.com/',
          headers:{
            'Content-Type':'application/json',
            'x-rapidapi-host':'grok-2-by-xai.p.rapidapi.com',
            'x-rapidapi-key':'82ae10db11mshb41ccacdd991130p108a22jsnf3ae22b94bbd'
          },
          data: {
            temperature: vm.temperature,
            model: 'Grok-2',
            messages: [{ content: payload, role: 'user' }],
            max_tokens: 2048
          }
        }).then(function(res){
          console.log('Raw API response:', res.data);
          var botReply = res.data?.choices?.[0]?.message?.content 
                         || res.data?.response 
                         || '(no reply)';
          vm.messages.push({role:'bot', content: botReply, ts:new Date()});
        }).catch(function(err){
          vm.messages.push({role:'bot', content:'[Error: '+(err.statusText||'failed')+']', ts:new Date()});
        }).finally(function(){
          vm.loading=false;
        });
      };

      vm.quickUplift = function(){
        vm.messages.push({role:'bot', content:'🌟 You are capable of amazing things. Keep going!', ts:new Date()});
      };

      vm.generateImage = function(){
        if(!vm.imgPrompt) return;
        vm.imgLoading=true;
        $http.post('https://api-inference.huggingface.co/models/your-flux-model',{
          inputs: vm.imgPrompt
        },{
          headers:{'Authorization':'Bearer YOUR_HF_TOKEN'}
        }).then(function(res){
          if(res.data && res.data.url){
            vm.imgUrl=res.data.url;
          }
        }).catch(function(){
          vm.imgUrl='';
        }).finally(function(){ vm.imgLoading=false; });
      };
    });
  </script>
</body>
</html>
